ВАРИАНТ 6.
=========
Уровень 1
---------
1. Дана схема базы данных в виде следующих отношений. С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1)

ПОТРЕБИТЕЛЬ
ИДЕНТИФИКАТОР | НАЗВАНИЕ | АДРЕС ЖИТЕЛЬСТВА | СКИДКА,%
--------------|----------|------------------|---------

ПОСТАВЩИК
ИДЕНТИФИКАТОР  |ФАМИЛИЯ  |АДРЕС  |КОММИСИОННЫЕ,%
---------------|---------|-------|--------------

ЗАКАЗ
НОМЕР  |ДАТА  |ПОТРЕБИТЕЛЬ  |ПОСТАВЩИК  |ДЕТАЛЬ  |КОЛ-ВО  |СУММА, РУБ
-------|------|-------------|-----------|--------|--------|----------

ДЕТАЛЬ
ИДЕНТИФИКАТОР  |НАИМЕНОВАНИЕ  |СКЛАД  |КОЛ-ВО  |ЦЕНА, РУБ
---------------|--------------|-------|--------|---------

```SQL
CREATE TABLE `ПОТРЕБИТЕЛЬ` (
  `ИДЕНТИФИКАТОР` int(11) NOT NULL AUTO_INCREMENT,
  `НАЗВАНИЕ` varchar(255) NOT NULL,
  `АДРЕС ЖИТЕЛЬСТВА` varchar(255) NOT NULL,
  `СКИДКА, %` int(11) NOT NULL,
  PRIMARY KEY(`ИДЕНТИФИКАТОР`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `ПОСТАВЩИК` (
  `ИДЕНТИФИКАТОР` int(11) NOT NULL AUTO_INCREMENT,
  `ФАМИЛИЯ` varchar(20) NOT NULL,
  `АДРЕС` varchar(30) NOT NULL,
  `КОММИСИОННЫЕ,%` int(11) NOT NULL,
  PRIMARY KEY(`ИДЕНТИФИКАТОР`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `ЗАКАЗ` (
  `НОМЕР` int(11) NOT NULL AUTO_INCREMENT,
  `ДАТА` varchar(20) NOT NULL,
  `ПОТРЕБИТЕЛЬ` int(11) NOT NULL,
  `ПОСТАВЩИК` int(11) NOT NULL,
  `ДЕТАЛЬ` int(11) NOT NULL,
  `КОЛ-ВО` int(11) NOT NULL,
  `СУММА, РУБ` int(11) NOT NULL,
  PRIMARY KEY(`НОМЕР`),
  CONSTRAINT ЗАКАЗ_ПОТРЕБИТЕЛЬ
  FOREIGN KEY (ПОТРЕБИТЕЛЬ) REFERENCES `ПОТРЕБИТЕЛЬ` (`ИДЕНТИФИКАТОР`) 
  ON UPDATE RESTRICT
  ON DELETE RESTRICT,
  CONSTRAINT ЗАКАЗ_ПОСТАВЩИК
  FOREIGN KEY (`ПОСТАВЩИК`) REFERENCES `ПОСТАВЩИК` (`ИДЕНТИФИКАТОР`) 
  ON UPDATE RESTRICT
  ON DELETE RESTRICT,
  CONSTRAINT ЗАКАЗ_ДЕТАЛЬ
  FOREIGN KEY (`ДЕТАЛЬ`) REFERENCES `ДЕТАЛЬ` (`ИДЕНТИФИКАТОР`) 
  ON UPDATE RESTRICT
  ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `ДЕТАЛЬ` (
  `ИДЕНТИФИКАТОР` int(11) NOT NULL AUTO_INCREMENT,
  `НАИМЕНОВАНИЕ` varchar(20) NOT NULL,
  `СКЛАД` varchar(20) NOT NULL,
  `КОЛ-ВО` int(11) NOT NULL,
  `ЦЕНА, РУБ` int(11) NOT NULL,
  PRIMARY KEY(`ИДЕНТИФИКАТОР`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE ПОТРЕБИТЕЛЬ CHECK (`СКИДКА, %` <= 100 AND `СКИДКА, %` >= 0);
ALTER TABLE ПОСТАВЩИК CHECK (`КОММИСИОННЫЕ,%` <= 100 AND `КОММИСИОННЫЕ,%` >= 0);
ALTER TABLE ЗАКАЗ CHECK (`КОЛ-ВО` >= 0 AND `СУММА, РУБ` > 0);
ALTER TABLE ДЕТАЛЬ CHECK (`КОЛ-ВО` >= 0 AND `ЦЕНА, РУБ` > 0);
```
2. Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту .
```SQL
INSERT INTO `ПОТРЕБИТЕЛЬ` (`ИДЕНТИФИКАТОР`, `НАЗВАНИЕ`, `АДРЕС ЖИТЕЛЬСТВА`, `СКИДКА, %`) VALUES
(1, 'АО ВАРЯ', 'Сормовский', 10),
(2, 'ГАЗ', 'Автозаводский', 7),
(3, 'МП ВЕРА', 'Канавинский', 5),
(4, 'МП', 'Канавинский', 3),
(5, 'АО СТАЛЬ', 'Советский', 0);

INSERT INTO `ПОСТАВЩИК` (`ИДЕНТИФИКАТОР`, `ФАМИЛИЯ`, `АДРЕС`, `КОММИСИОННЫЕ,%`) VALUES
(1, 'Артюхина', 'Сормовский', 4),
(2, 'Щепин', 'Приокский', 4),
(3, 'Власов', 'Канавинский', 5),
(4, 'Кузнецова', 'Советский', 5),
(5, 'Цепилева', 'Нижегородский', 3),
(6, 'Корнилов', 'Нижегородский', 6);

INSERT INTO `ЗАКАЗ` (`НОМЕР`, `ДАТА`, `ПОТРЕБИТЕЛЬ`, `ПОСТАВЩИК`, `ДЕТАЛЬ`, `КОЛ-ВО`, `СУММА, РУБ`) VALUES
(1, 'Январь', 5, 4, 3, 7, 21000),
(2, 'Февраль', 3, 3, 3, 2, 6000),
(3, 'Февраль', 4, 5, 4, 200, 180000),
(4, 'Март', 5, 4, 2, 50, 50000),
(5, 'Апрель', 1, 6, 7, 110, 132000),
(6, 'Апрель', 4, 4, 1, 150, 750000),
(7, 'Май', 2, 4, 6, 20, 40000),
(8, 'Июнь', 1, 3, 7, 2000, 2400000),
(9, 'Июнь', 2, 5, 7, 10000, 12000000),
(10, 'Июнь', 3, 6, 1, 5, 25000),
(11, 'Июнь', 4, 3, 3, 1, 3000),
(12, 'Июнь', 4, 4, 1, 10, 50000),
(13, 'Июль', 1, 6, 6, 3, 6000),
(14, 'Июль', 2, 1, 2, 1000, 1000000),
(15, 'Июль', 2, 2, 1, 100, 5000000),
(16, 'Июль', 5, 1, 5, 100, 15000),
(17, 'Август', 1, 4, 7, 12000, 24400000);

INSERT INTO `ДЕТАЛЬ` (`ИДЕНТИФИКАТОР`, `НАИМЕНОВАНИЕ`, `СКЛАД`, `КОЛ-ВО`, `ЦЕНА, РУБ`) VALUES
(1, 'Втулка', 'Сормовский', 20000, 5000),
(2, 'Болт', 'Сормовский', 40000, 1000),
(3, 'Ключ гаечный', 'Канавинский', 5000, 3000),
(4, 'Шпилька', 'Автозаводский', 10000, 900),
(5, 'Винт', 'Сормовский', 50000, 1500),
(6, 'Молоток', 'Канавинский', 1200, 2000),
(7, 'Шуруп', 'Сормовский', 30000, 1200);
```

3. Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE.
```sql
SELECT * FROM ПОТРЕБИТЕЛЬ;

| ИДЕНТИФИКАТОР | НАЗВАНИЕ | АДРЕС ЖИТЕЛЬСТВА | СКИДКА, % |
|---------------|----------|------------------|-----------|
|             1 | АО ВАРЯ  | Сормовский       |        10 |
|             2 | ГАЗ      | Автозаводский    |         7 |
|             3 | МП ВЕРА  | Канавинский      |         5 |
|             4 | МП       | Канавинский      |         3 |
|             5 | АО СТАЛЬ | Советский        |         0 |

SELECT * FROM ПОТРЕБИТЕЛЬ;
| ИДЕНТИФИКАТОР | ФАМИЛИЯ   | АДРЕС         | КОММИСИОННЫЕ,% |
|---------------|-----------|---------------|----------------|
|             1 | Артюхина  | Сормовский    |              4 |
|             2 | Щепин     | Приокский     |              4 |
|             3 | Власов    | Канавинский   |              5 |
|             4 | Кузнецова | Советский     |              5 |
|             5 | Цепилева  | Нижегородский |              3 |
|             6 | Корнилов  | Нижегородский |              6 |

SELECT * FROM ЗАКАЗ;
| НОМЕР | ДАТА    | ПОТРЕБИТЕЛЬ | ПОСТАВЩИК | ДЕТАЛЬ | КОЛ-ВО | СУММА, РУБ |
|-------|---------|-------------|-----------|--------|--------|------------|
|     1 | Январь  |           5 |         4 |      3 |      7 |      21000 |
|     2 | Февраль |           3 |         3 |      3 |      2 |       6000 |
|     3 | Февраль |           4 |         5 |      4 |    200 |     180000 |
|     4 | Март    |           5 |         4 |      2 |     50 |      50000 |
|     5 | Апрель  |           1 |         6 |      7 |    110 |     132000 |
|     6 | Апрель  |           4 |         4 |      1 |    150 |     750000 |
|     7 | Май     |           2 |         4 |      6 |     20 |      40000 |
|     8 | Июнь    |           1 |         3 |      7 |   2000 |    2400000 |
|     9 | Июнь    |           2 |         5 |      7 |  10000 |   12000000 |
|    10 | Июнь    |           3 |         6 |      1 |      5 |      25000 |
|    11 | Июнь    |           4 |         3 |      3 |      1 |       3000 |
|    12 | Июнь    |           4 |         4 |      1 |     10 |      50000 |
|    13 | Июль    |           1 |         6 |      6 |      3 |       6000 |
|    14 | Июль    |           2 |         1 |      2 |   1000 |    1000000 |
|    15 | Июль    |           2 |         2 |      1 |    100 |    5000000 |
|    16 | Июль    |           5 |         1 |      5 |    100 |      15000 |
|    17 | Август  |           1 |         4 |      7 |  12000 |   24400000 |

SELECT * FROM ДЕТАЛЬ;
| ИДЕНТИФИКАТОР | НАИМЕНОВАНИЕ | СКЛАД         | КОЛ-ВО | ЦЕНА, РУБ |
|---------------|--------------|---------------|--------|-----------|
|             1 | Втулка       | Сормовский    |  20000 |      5000 |
|             2 | Болт         | Сормовский    |  40000 |      1000 |
|             3 | Ключ гаечный | Канавинский   |   5000 |      3000 |
|             4 | Шпилька      | Автозаводский |  10000 |       900 |
|             5 | Винт         | Сормовский    |  50000 |      1500 |
|             6 | Молоток      | Канавинский   |   1200 |      2000 |
|             7 | Шуруп        | Сормовский    |  30000 |      1200 |
  
4. Создать запросы для вывода:
a) всех различных размеров комиссионных;
SELECT DISTINCT `КОММИСИОННЫЕ,%` FROM ПОСТАВЩИК;
| КОММИСИОННЫЕ,% |
|----------------|
|              4 |
|              5 |
|              3 |
|              6 |

b) всех различных фамилий поставщиков;
SELECT DISTINCT `ФАМИЛИЯ` FROM ПОСТАВЩИК;
| ФАМИЛИЯ   |
|-----------|
| Артюхина  |
| Щепин     |
| Власов    |
| Кузнецова |
| Цепилева  |
| Корнилов  |

c) всех различных наименований деталей.
SELECT DISTINCT `НАИМЕНОВАНИЕ` FROM ДЕТАЛЬ;
| НАИМЕНОВАНИЕ |
|--------------|
| Втулка       |
| Болт         |
| Ключ гаечный |
| Шпилька      |
| Винт         |
| Молоток      |
| Шуруп        |

5. Создав запрос получить следующую информацию:
a) фамилии и адреса поставщиков, имеющих размер комиссионных менее 5%;
SELECT ФАМИЛИЯ, АДРЕС,`КОММИСИОННЫЕ,%` FROM ПОСТАВЩИК WHERE `КОММИСИОННЫЕ,%` < 5;
| ФАМИЛИЯ  | АДРЕС         | КОММИСИОННЫЕ,% |
|----------|---------------|-----------------|
| Артюхина | Сормовский    |              4 |
| Щепин    | Приокский     |              4 |
| Цепилева | Нижегородский |              3 |

b) название и адрес склада для деталей, находящихся в количесиве менее 1500 шт.;
SELECT СКЛАД, `КОЛ-ВО`, НАИМЕНОВАНИЕ FROM ДЕТАЛЬ WHERE `КОЛ-ВО` < 1500;
| СКЛАД       | КОЛ-ВО | НАИМЕНОВАНИЕ |
|-------------|--------|--------------|
| Канавинский |   1200 | Молоток      |

c) название, адрес и размер скидки для предприятий, имеющих в названии слово “МП”. Отсортировать по адресу и размеру скидки.
SELECT НАЗВАНИЕ, `АДРЕС ЖИТЕЛЬСТВА`, `СКИДКА, %` FROM ПОТРЕБИТЕЛЬ WHERE НАЗВАНИЕ LIKE 'МП%' ORDER BY `АДРЕС ЖИТЕЛЬСТВА`,`СКИДКА, %`;
| НАЗВАНИЕ | АДРЕС ЖИТЕЛЬСТВА | СКИДКА, % |
|----------|------------------|-----------|
| МП       | Канавинский      |         3 |
| МП ВЕРА  | Канавинский      |         5 |

6. На основании данных о заказах вывести все данные в таком формате:
a) номер, дата, фамилия поставщика, сумма заказа. Отсортировать по фамилиям и сумме заказа;
SELECT НОМЕР, ДАТА, ФАМИЛИЯ, `СУММА, РУБ` FROM ЗАКАЗ, ПОСТАВЩИК WHERE ЗАКАЗ.ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР ORDER BY ФАМИЛИЯ, 'СУММА, РУБ';
| НОМЕР | ДАТА    | ФАМИЛИЯ   | СУММА, РУБ |
|-------|---------|-----------|------------|
|    14 | Июль    | Артюхина  |    1000000 |
|    16 | Июль    | Артюхина  |      15000 |
|     8 | Июнь    | Власов    |    2400000 |
|     2 | Февраль | Власов    |       6000 |
|    11 | Июнь    | Власов    |       3000 |
|    10 | Июнь    | Корнилов  |      25000 |
|     5 | Апрель  | Корнилов  |     132000 |
|    13 | Июль    | Корнилов  |       6000 |
|     1 | Январь  | Кузнецова |      21000 |
|    17 | Август  | Кузнецова |   24400000 |
|    12 | Июнь    | Кузнецова |      50000 |
|     7 | Май     | Кузнецова |      40000 |
|     4 | Март    | Кузнецова |      50000 |
|     6 | Апрель  | Кузнецова |     750000 |
|     3 | Февраль | Цепилева  |     180000 |
|     9 | Июнь    | Цепилева  |   12000000 |
|    15 | Июль    | Щепин     |    5000000 |

b) название детали, количество, дата.
SELECT НАИМЕНОВАНИЕ, ЗАКАЗ.`КОЛ-ВО`, ДАТА FROM ЗАКАЗ, ДЕТАЛЬ WHERE ЗАКАЗ.ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР;
| НАИМЕНОВАНИЕ | КОЛ-ВО | ДАТА    |
|--------------|--------|---------|
| Ключ гаечный |      7 | Январь  |
| Ключ гаечный |      2 | Февраль |
| Шпилька      |    200 | Февраль |
| Болт         |     50 | Март    |
| Шуруп        |    110 | Апрель  |
| Втулка       |    150 | Апрель  |
| Молоток      |     20 | Май     |
| Шуруп        |   2000 | Июнь    |
| Шуруп        |  10000 | Июнь    |
| Втулка       |      5 | Июнь    |
| Ключ гаечный |      1 | Июнь    |
| Втулка       |     10 | Июнь    |
| Молоток      |      3 | Июль    |
| Болт         |   1000 | Июль    |
| Втулка       |    100 | Июль    |
| Винт         |    100 | Июль    |
| Шуруп        |  12000 | Август  |

7. Вывести:
a) названия и размер скидки организаций-потребителей, куда поставлял детали Щепин, а общая сумма заказа превышала 5000;
SELECT ПОТРЕБИТЕЛЬ.НАЗВАНИЕ, ПОТРЕБИТЕЛЬ.`СКИДКА, %`, ПОСТАВЩИК.ФАМИЛИЯ, ЗАКАЗ.`СУММА, РУБ` FROM ПОТРЕБИТЕЛЬ, ПОСТАВЩИК, ЗАКАЗ WHERE ПОСТАВЩИК.ФАМИЛИЯ LIKE 'Щепин' AND ЗАКАЗ.ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР AND ЗАКАЗ.ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР GROUP BY ПОТРЕБИТЕЛЬ.НАЗВАНИЕ, ПОТРЕБИТЕЛЬ.`СКИДКА, %`, ПОСТАВЩИК.ФАМИЛИЯ, ЗАКАЗ.`СУММА, РУБ` HAVING SUM(ЗАКАЗ.`СУММА, РУБ`) > 5000;
| НАЗВАНИЕ | СКИДКА, % | ФАМИЛИЯ | СУММА, РУБ |
|----------|-----------|---------|------------|
| ГАЗ      |         7 | Щепин   |    5000000 |

b) фамилии и размер комиссионных для поставщиков, поставлявших детали предприятиям чужих районов не ранее января. Отсортировать по возрастанию комиссионных; 
из условия следует, что все месяца входят, но мы решили, что не включая январь
SELECT DISTINCT ПОСТАВЩИК.ФАМИЛИЯ, ПОСТАВЩИК.`КОММИСИОННЫЕ,%` FROM ПОСТАВЩИК, ЗАКАЗ, ПОТРЕБИТЕЛЬ WHERE ЗАКАЗ.ДАТА NOT LIKE 'Январь' AND ЗАКАЗ.ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР AND ПОСТАВЩИК.АДРЕС != ПОТРЕБИТЕЛЬ.`АДРЕС ЖИТЕЛЬСТВА`;
| ФАМИЛИЯ   | КОММИСИОННЫЕ,% |
|-----------|----------------|
| Власов    |              5 |
| Цепилева  |              3 |
| Кузнецова |              5 |
| Корнилов  |              6 |
| Артюхина  |              4 |
| Щепин     |              4 |

c) название и оставшееся количество деталей, заказывавшихся в количестве более 2 штук предприятиями Автозаводского и Советского районов. В вывод добавить суммарную стоимость соответствующих заказов;
SELECT ДЕТАЛЬ.НАИМЕНОВАНИЕ, ДЕТАЛЬ.`КОЛ-ВО`, SUM(ЗАКАЗ.`СУММА, РУБ`) FROM ДЕТАЛЬ, ПОТРЕБИТЕЛЬ, ЗАКАЗ WHERE ЗАКАЗ.`КОЛ-ВО` > 2 AND (ПОТРЕБИТЕЛЬ.`АДРЕС ЖИТЕЛЬСТВА` LIKE 'Автозаводский' OR ПОТРЕБИТЕЛЬ.`АДРЕС ЖИТЕЛЬСТВА` LIKE 'Советский') GROUP DY ДЕТАЛЬ.НАИМЕНОВАНИЕ, ДЕТАЛЬ.`КОЛ-ВО`;

8.Cздать запрос для модификации всех значений столбца с суммарной величиной платы, чтобы он содержал истинную сумму, которую заплатил потребитель ( с учетом скидки). Вывести новые значения.
